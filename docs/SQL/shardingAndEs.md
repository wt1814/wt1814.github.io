

<!-- TOC -->

- [1. 分库分表和ES（分库分表迁移测试实践）](#1-分库分表和es分库分表迁移测试实践)
    - [1.1. 背景](#11-背景)
    - [1.2. 分析与设计](#12-分析与设计)
        - [1.2.1. 采用水平拆分](#121-采用水平拆分)
        - [1.2.2. ★★★分表数量，分表字段](#122-★★★分表数量分表字段)
        - [1.2.3. ★★★接入es分析](#123-★★★接入es分析)
    - [1.3. 分库分表测试思路](#13-分库分表测试思路)

<!-- /TOC -->


# 1. 分库分表和ES（分库分表迁移测试实践）  


<!-- 
https://tech.kujiale.com/fen-ku-fen-biao-qian-yi-ce-shi-shi-jian/

冷热分离  
-->

## 1.1. 背景  



## 1.2. 分析与设计

### 1.2.1. 采用水平拆分  



### 1.2.2. ★★★分表数量，分表字段  



### 1.2.3. ★★★接入es分析  
* 优点：海量查询。  
* 缺点：延迟，查询耗时是数据库的至少十倍级。稳定性没有数据库稳定。  

* 方案：  
&emsp; y表的查询主要是根据主键进行条筛选查询，基于这样的查询语句以及es的缺点，最终决定y表的查询主要还是查库，查询字段较多的做索引。  
&emsp; x表的查询会经常采用全表扫面的语句，基于这样的查询语句以及es的优点，决定把x表接入es。  

* 风险考虑：接入es会有风险，没有另外存储一份数据，自然也没有降级策略，反而也不能有降级，如果降级数据库查询，接近于全表扫描的语句会给数据库造成很大压力。只把这样的查询接入es，一个是因为这样的查询语句是基本都用在轮询查询，可以有一定的延迟，不一定马上要求返回结果，就算es真的出现问题，不会有较大的感知，业务可能出现的感知就是进行中的状态，通常这样的业务也是允许有一定的延迟，其次，这样的查询比较少，权衡之后，可以接入es。  


## 1.3. 分库分表测试思路



