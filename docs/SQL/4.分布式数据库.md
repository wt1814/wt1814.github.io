---
title: 分布式数据库
date: 2020-02-27 00:00:00
tags:
    - SQL
---  

# 1. 数据库瓶颈  

&emsp; 不管是IO瓶颈，还是CPU瓶颈，最终都会导致数据库的活跃连接数增加，进而逼近甚至达到数据库可承载活跃连接数的阈值。在业务Service来看就是，可用数据库连接少甚至无连接可用。  
1. IO瓶颈：  
&emsp; 第一种：磁盘读IO瓶颈，热点数据太多，数据库缓存放不下，每次查询时会产生大量的IO，降低查询速度 -> 分库和垂直分表。  
&emsp; 第二种：网络IO瓶颈，请求的数据太多，网络带宽不够 -> 分库。  
2. CPU瓶颈：  
&emsp; 第一种：SQL问题，如SQL中包含join，group by，order by，非索引字段条件查询等，增加CPU运算的操作 -> SQL优化，建立合适的索引，在业务Service层进行业务计算。  
&emsp; 第二种：单表数据量太大，查询时扫描的行太多，SQL效率低，CPU率先出现瓶颈 -> 水平分表。  
&emsp; 根据业务特点，单表 > 分区 > 单库分表 > 分库分表，在满足业务前提下，优先级从左到右。  

&emsp; MySql一般并发数200～500。  
&emsp; 单表的数据量达到1000W或100G以后，性能下降严重。此时考虑对数据库切分。数据库拆分过程基本遵循的顺序是：1).垂直拆分（业务拆分）、2).读写分离、3).分库分表(水平拆分)。每个拆分过程都能解决业务上的一些问题，但同时也面临了一些挑战。  
&emsp; 数据库分布式核心内容是数据切分（Sharding），以及切分后对数据的定位、整合。数据切分就是将数据分散存储到多个数据库中，使得单一数据库中的数据量变小，通过扩充主机的数量缓解单一数据库的性能问题，从而达到提升数据库操作性能的目的。  




