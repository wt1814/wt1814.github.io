
<!-- TOC -->

- [1. 外部排序](#1-外部排序)
    - [1.1. 外部排序简介](#11-外部排序简介)
    - [1.2. 外部排序一般流程](#12-外部排序一般流程)
        - [1.2.1. 初始顺串](#121-初始顺串)
        - [1.2.2. 合并排序](#122-合并排序)
    - [1.3. 其他算法](#13-其他算法)

<!-- /TOC -->


# 1. 外部排序  
<!-- 
外部排序
https://baike.baidu.com/item/%E5%A4%96%E9%83%A8%E6%8E%92%E5%BA%8F/10595890?fr=aladdin
-->

## 1.1. 外部排序简介
&emsp; <font color = "red">外部排序指的是大文件的排序，即待排序的记录存储在外存储器上，</font>待排序的文件无法一次装入内存，需要在内存和外部存储器之间进行多次数据交换，以达到排序整个文件的目的。  
<!-- 
&emsp; 外部排序指的是大文件的排序，当待排序的文件很大时，无法将整个文件的所有记录同时调入内存进行排序，只能将文件存放在外存，这种排序称为外部排序。外部排序的过程主要是依据数据的内外存交换和“内部归并”两者结合起来实现的。  
&emsp; 一般提到排序都是指内排序，比如快速排序，堆排序，归并排序等，所谓内排序就是可以在内存中完成的排序。RAM的访问速度大约是磁盘的25万倍，我们当然希望如果可以的话都是内排来完成。但对于大数据集来说，内存是远远不够的，这时候就涉及到外排序的知识了。 
-->  
&emsp; <font color = "lime">外部排序最常用的算法是多路归并排序，即将原文件分解成多个能够一次性装入内存的部分分别把每一部分调入内存完成排序。</font>然后，对已经排序的子文件进行归并排序。  

## 1.2. 外部排序一般流程
&emsp; <font color = "lime">一般来说外排序分为两个步骤：预处理和合并排序。</font>首先，根据可用内存的大小，将外存上含有n个纪录的文件分成若干长度为t的子文件（或段）；其次，利用内部排序的方法，对每个子文件的t个纪录进行内部排序。这些经过排序的子文件（段）通常称为顺串(run)，顺串生成后即将其写入外存。这样在外存上就得到了m个顺串（m=[n/t]）。最后，对这些顺串进行归并，使顺串的长度逐渐增大，直到所有的待排序的记录成为一个顺串为止。  

### 1.2.1. 初始顺串  
&emsp; 预处理阶段最重要的事情就是选择初始顺串。通常使用的方法为置换选择排序，它是堆排序的一种变形，实现思路同STL的partial_sort。步骤如下：  
1. 初始化堆  
&emsp; 从磁盘读入M个记录放到数组RAM中；  
&emsp; 设置堆末尾标准LAST=M-1；  
&emsp; 建立最小值堆。  
2. 重复以下步骤直到堆为空  
&emsp; 把具有最小关键码值的记录Min也就是根节点送到输出缓冲区；  
&emsp; 设R是输入缓冲区中的下一条记录，如果R的关键码大于刚刚输出的关键码值Min，则把R放到根节点，否则使用数组中LAST位置的记录代替根节点，并将刚才的R放入到LAST所在位置，LAST=LAST-1；  
3. 重新排列堆，筛出根节点。  
&emsp; 如果堆的大小是M，一个顺串的最小长度就是M个记录，因为至少原来在堆中的那些记录将成为顺串的一部分，如果输入时逆序的，那么顺串的长度只能是M，最好情况输入是正序的，有可能一次性就能把整个文件生成一个顺串，由此可见生成顺串的长度是大小不一的，但是每个顺串却是有序的，利用扫雪机模型能够得到平均顺串的长度为2M。  

&emsp; 外部排序最常用的算法是多路归并排序，即将原文件分解成多个能够一次性装入内存的部分，分别把每一部分调入内存完成排序。然后，对已经排序的子文件进行归并排序。

### 1.2.2. 合并排序  



## 1.3. 其他算法  
&emsp; 外归并排序法并不是唯一的外排序算法。另外还有外分配排序，其原理类似于内排序中的桶排序。在归并排序和桶排序之间存在数学上的某种对偶性。此外还有一些不耗费附加磁盘空间的原地排序算法。  


