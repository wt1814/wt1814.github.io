



<!-- 
https://mp.weixin.qq.com/s/VY31lBOSggOHvVf54GzvYw
https://mp.weixin.qq.com/s/f71rakde6KBJ_ilRf1M8xQ

-->


1. 什么是 SDS？ Redis中字符串的实现。在 3.2 以后的版本中，SDS 又有多种结构（sds.h）：sdshdr5、sdshdr8、sdshdr16、sdshdr32、sdshdr64，用于存储不同的长度的字符串，分别代表 2^5=32byte， 2^8=256byte，2^16=65536byte=64KB，2^32byte=4GB。  

2. 为什么 Redis 要用 SDS 实现字符串？  
&emsp; C 语言本身没有字符串类型（只能用字符数组 char[]实现）。 
    1. 使用字符数组必须先给目标变量分配足够的空间，否则可能会溢出。  
    2. 如果要获取字符长度，必须遍历字符数组，时间复杂度是 O(n)。  
    3. C 字符串长度的变更会对字符数组做内存重分配。  
    4. 通过从字符串开始到结尾碰到的第一个'\0'来标记字符串的结束，因此不能保 存图片、音频、视频、压缩文件等二进制(bytes)保存的内容，二进制不安全。  

    &emsp; SDS的特点：  
    1. 不用担心内存溢出问题，如果需要，会对 SDS 进行扩容。  
    2. 获取字符串长度时间复杂度为 O(1)，因为定义了 len 属性。  
    3. 通过“空间预分配”（ sdsMakeRoomFor）和“惰性空间释放”，防止多次重分配内存。  
    4. 判断是否结束的标志是 len 属性（它同样以'\0'结尾是因为这样就可以使用 C语言中函数库操作字符串的函数了），可以包含'\0'。  

