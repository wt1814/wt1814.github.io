
<!-- TOC -->

- [1. Kafka网络IO优化](#1-kafka网络io优化)
    - [1.1. 批量读写](#11-批量读写)
    - [1.2. 批量压缩](#12-批量压缩)

<!-- /TOC -->


# 1. Kafka网络IO优化
<!-- 
kafka——高效读写数据
https://www.jianshu.com/p/ce8253609b6b
-->

## 1.1. 批量读写  
&emsp; Kafka数据读写也是批量的而不是单条的。  
&emsp; 除了利用底层的技术外，Kafka还在应用程序层面提供了一些手段来提升性能。最明显的就是使用批次。在向Kafka写入数据时，可以启用批次写入，这样可以避免在网络上频繁传输单个消息带来的延迟和带宽开销。假设网络带宽为10MB/S，一次性传输10MB的消息比传输1KB的消息10000万次显然要快得多。  

---------



## 1.2. 批量压缩  
&emsp; 在很多情况下，系统的瓶颈不是CPU或磁盘，而是网络IO，对于需要在广域网上的数据中心之间发送消息的数据流水线尤其如此。进行数据压缩会消耗少量的CPU资源,不过对于kafka而言,网络IO更应该需要考虑。  

1. 如果每个消息都压缩，但是压缩率相对很低，所以Kafka使用了批量压缩，即将多个消息一起压缩而不是单个消息压缩  
2. Kafka允许使用递归的消息集合，批量的消息可以通过压缩的形式传输并且在日志中也可以保持压缩格式，直到被消费者解压缩  
3. Kafka支持多种压缩协议，包括Gzip和Snappy压缩协议  

&emsp; Kafka速度的秘诀在于，它把所有的消息都变成一个批量的文件，并且进行合理的批量压缩，减少网络IO损耗，通过mmap提高I/O速度，写入数据的时候由于单个 Partition 是末尾添加所以速度最优；读取数据的时候配合sendfile直接暴力输出。  

----------------

