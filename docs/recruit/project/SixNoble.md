
<!-- TOC -->

- [1. 六合数字化心理平台](#1-六合数字化心理平台)
    - [1.1. 项目介绍（简历上写的）](#11-项目介绍简历上写的)
    - [1.2. 项目收获](#12-项目收获)
    - [1.3. 项目难点](#13-项目难点)
        - [1.3.1. 数据量大，分库分表和ES](#131-数据量大分库分表和es)
        - [1.3.2. 高并发](#132-高并发)
        - [1.3.3. 二级缓存](#133-二级缓存)

<!-- /TOC -->


# 1. 六合数字化心理平台  

## 1.1. 项目介绍（简历上写的）

* 2022.04---至今 &emsp; &emsp; 六合熙诚信息科技有限公司 &emsp; &emsp; 六合数字化心理平台    
    * 核心技术：SpringCloud+MySql+MyBatis+ES+kafka+redis  
    * 项目描述：六合数字化心理平台，提供心理咨询和测评，系统支持5W人同时在线测试。  
    * 项目职责：答题系统、咨询系统、大屏系统的开发维护。  
        1. 答题流程及答题结果的处理。答题结果采用库内水平分表处理。    
        2. 用户咨询预约、咨询结果记录。  
        3. 大屏使用ES展示各机构的完成情况。  
    * 项目业绩：  
        1. 协助从0到1搭建起 Maven+Git+Jenkins+Docker敏捷流程，大幅缩短项目落地工期。搭建Sql审核平台Archery
        2. 获取试题接口优化。响应时间从5S优化到200ms左右。采用缓存预热和引入二级缓存处理。  

* 2022.04---至今 &emsp; &emsp; 六合熙诚信息科技有限公司 &emsp; &emsp; 六合数字化心理平台    
    * 核心技术：SpringCloud+MySql+MyBatis+ES+kafka+redis  
    * 项目描述：六合数字化心理平台，提供心理咨询和测评，系统支持5W人同时在线测试。  
    * 项目职责：用户系统、支付系统、工具类的开发维护。  
        1. 手机验证码、短信验证码登录，后台功能权限、数据权限验证。  
        2. 支付系统的搭建，集成阿里App、微信JSAPI方式。  
        3. 建立数据字典表，用于输入框级联展示、集成阿里OSS上传下载。



## 1.2. 项目收获  


## 1.3. 项目难点  

### 1.3.1. 数据量大，分库分表和ES
1. 分库分表：  

    0. 主键设计：用户id，项目id，量表id，测评结果表（分8个库，主键id后3位使用用户id），采用hash分片  
    1. 根据主键查，
    2. 根据用户id查询，
    3. 根据量表id查？？？？
    4. 全表查，使用ES查。  

    &emsp; 分表id基因法： userId --> 换算二进制---> 抽取3位  --->  生成分表id前60+刚刚的30  

2. ES使用：  
    1. 采用定时同步到ES。  
    2. ES分页模糊：
        https://blog.csdn.net/chaitao100/article/details/125889713  
        searchSourceBulider https://blog.csdn.net/qq_39601612/article/details/104680399  
        https://developer.aliyun.com/article/1234768     


### 1.3.2. 高并发

1. 支持5W人同时在线测。5题一提交，最后一题提交时，查询所有题是否做完。  
2. 性能：单台4c8G的QPS6000，5W人总QPS8W，需要15台服务器左右。  

--------

CPU利用率：CPU利用率在过去常常被我们这些外行认为是判断机器是否已经到了满负荷的一个标准。看到70%-80%的使用率就认为机器就已经压到了临界了。  

https://www.cnblogs.com/capacity-yang/p/13064775.html 

　　假设服务并发度为1500，RT为150ms，那么该服务的QPS 为10000 = 1500（并发数） /  0.15 （RT响应时间） ，假如通过压测一台机器的QPS为500，那么该服务需要20台这样的机器。


一直再说高并发，多少QPS才算高并发？  
比如微博每天1亿多pv的系统一般也就1500QPS，5000QPS峰值。

比如有人说：

2C4G机器单机一般1000QPS。
8C8G机器单机可承受7000QPS。



### 1.3.3. 二级缓存  


