# SpringIOC  
## 1.IOC容器的设计与实现  
### BeanFactory  
### ApplicationContext  
### BeanDefinition
### BeanDefinitionReader  

----
## 2.Spring容器初始化的入口  
&emsp; 启动容器，实际上指实例化ApplicationContext。只是在不同情况下可能有不同的表现形式。  
1. ClassPathXmlApplicationContext 通过XML配置  

```java
public static void main(String[] args) {
    ApplicationContext context = new ClassPathXmlApplicationContext("classpath:applicationfile.xml");
}
```
2. AnnotationConfigApplicationContext通过java config类配置  

```java
@Configuration
@ComponentScan("ric.study.demo.ioc")
public class BeanDemoConfig {
    public static void main(String... strings) {
        AnnotationConfigApplicationContext context =
                new AnnotationConfigApplicationContext(BeanDemoConfig.class);
        System.out.println("Spring container started and is ready");
    }
}
```  
----
## 3.基于Xml的IOC容器ClassPathXmlApplicationContext 的初始化  
&emsp; ClassPathXmlApplicationContext容器的初始化包括BeanDefinition的resource定位、载入和注册这三个基本的过程。  
&emsp; 1. BeanDefinition的resource的定位过程，就是找到定义bean的相关的xml文件，是通过继承ResourceLoader 获得的，ResourceLoader代表了加载资源的一种方式，正是策略模式的实现。  
&emsp; 2. BeanDifinition的载入，就是把用户在xml中定义好的bean解析成为IoC的内部数据结构，也就是BeanDifinition。  
&emsp; 3. BeanDifinition的注册，向IoC容器注册这些BeanDifinition，把BeanDifinition注册到一个Map中保存。  
### 容器初始化时序图：  

### 1. BeanDefinition的Resource定位  
&emsp; 启动 IoC 容器，即实例化ClassPathXmlApplicationContext 上下文，首先查看其构造函数：  

```java
public class ClassPathXmlApplicationContext extends AbstractXmlApplicationContext {
    private Resource[] configResources;

    // 如果已经有 ApplicationContext 并需要配置成父子关系，那么调用这个构造方法
    public ClassPathXmlApplicationContext(ApplicationContext parent) {
        super(parent);
    }
    ...
    public ClassPathXmlApplicationContext(String[] configLocations, boolean refresh, ApplicationContext parent)
            throws BeansException {

        super(parent);
        // 根据提供的路径，处理成配置文件数组(以分号、逗号、空格、tab、换行符分割)
        setConfigLocations(configLocations);
        if (refresh) {
            refresh(); // 核心方法
        }
    }
    ...
}
```  
&emsp; 入参中的configLocations在这里就是XML配置文件的classpath。  
&emsp; setConfigLocations(configLocations);把一些带有占位符的地址解析成实际的地址。  



